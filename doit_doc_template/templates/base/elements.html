{#                                                        -*- coding: utf-8 -*-
##! \file    ~/doit_doc_template/templates/base/elements.html
##! \author  Jiří Kučera, <sanczes AT gmail.com>
##! \stamp   2019-02-23 13:15:47 +0100
##! \project DoIt! Doc: Sphinx Extension for DoIt! Documentation
##! \license MIT
##! \version 0.0.0
##! \brief   Set of basic document elements as a Jinja2 macros.
#}

{# HTML Document Header Macros #}

{% macro html_strict() %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
{% endmacro %}

{% macro head_meta_content_language(lang) %}
<meta http-equiv="content-language" content="{{ lang }}" />
{% endmacro %}

{% macro head_meta_content_type(type, charset) %}
<meta http-equiv="content-type" content="{{ type }}{% if charset %}; charset={{ charset }}{% endif %}" />
{% endmacro %}

{% macro head_meta_author(author) %}
<meta name="author" content="{{ author }}" />
{% endmacro %}

{% macro head_meta_keywords(keywords) %}
<meta name="keywords" content="{{ keywords|join(', ') }}" />
{% endmacro %}

{% macro head_meta_description(description) %}
<meta name="description" content="{{ description }}" />
{% endmacro %}

{% macro head_meta_viewport(width, initial_scale) %}
<meta name="viewport" content="{% set comma = joiner(', ') %}{% if width %}{% comma() %}width={{ width }}{% endif %}{% if initial_scale %}{% comma() %}initial-scale={{ initial_scale }}{% endif %}" />
{% endmacro %}

{% macro head_stylesheet(stylesheet) %}
<link rel="stylesheet" type="text/css" href="{{ stylesheet }}" />
{% endmacro %}

{% macro head_script(script) %}
<script type="text/javascript" src="{{ script }}"></script>
{% endmacro %}

{% macro head_title(title) %}
<title>{{ title }}</title>
{% endmacro %}

{% macro html_head(title, lang='en', type='text/html', charset='utf-8', author='', keywords=[], description='', width='device-width', initial_scale='1.0', stylesheets=[], scripts=[]) %}
<head>
{% if lang %}{{ head_meta_content_language(lang) }}{% endif %}
{% if type %}{{ head_meta_content_type(type, charset) }}{% endif %}
{% if author %}{{ head_meta_author(author) }}{% endif %}
{% if keywords %}{{ head_meta_keywords(keywords) }}{% endif %}
{% if description %}{{ head_meta_description(description) }}{% endif %}
{% if width or initial_scale %}{{ head_meta_viewport(width, initial_scale) }}{% endif %}
{% for stylesheet in stylesheets %}
  {{ head_stylesheet(stylesheet) }}
{% endfor %}
{% for script in scripts %}
  {{ head_script(script) }}
{% endfor %}
  {{ head_title(title) }}
</head>
{% endmacro %}

{# HTML Document Body Macros #}

{% macro intag(ns) %}
{% if ns.id %} id="{{ ns.id }}"{% endif %}{% if ns.classes %} class="{{ ns.classes|join(' ') }}"{% endif %}
{% endmacro %}

{% macro emphasize(ctx, text) %}
<em{{ intag(ctx.emphasize.em) }}>{{ text }}</em>
{% endmacro %}

{% macro header(ctx, content, subcontent='') %}
<div{{ intag(ctx.header.div) }}>
  <h1{{ intag(ctx.header.div.h1) }}>{{ content }}</h1>
{% if subcontent %}{{ indent() }}<p{{ intag(ctx.header.div.p) }}>{{ subcontent }}</p>{% endif %}
</div>
{% endmacro %}

{% macro lnavbar(ctx, links) %}
<div{{ intag(ctx.lnavbar.div) }}>
{% for link in links %}
  <a href="{{ link.href }}"{{ intag(ctx.lnavbar.div.a[link.name]) }}>{{ link.title }}</a>
{% endfor %}
</div>
{% endmacro %}

{% macro toc(ctx, title, items) %}
<h2{{ intag(ctx.toc.h2) }}>{{ title }}</h2>
<ul{{ intag(ctx.toc.ul) }}>
{% for item in items recursive %}
{% if loop.depth0 == 0 and not loop.first %}{% set l = 1 %}{% else %}{% set l = 0 %}{% endif %}
{% if l == 1 %}
  <p{{ intag(ctx.toc.ul.p[item.name]) }}>
{% endif %}
    <li{{ intag(ctx.toc.ul.li[item.name]) }}><a href="{{ item.href }}"{{ intag(ctx.toc.ul.li[item.name].a) }}>{{ item.title }}</a></li>
{% if item.subitems %}
    <ul{{ intag(ctx.toc.ul.ul[item.name]) }}>
    {{ loop(item.subitems) }}
    </ul>
{% endif %}
{% if l == 1 %}
  </p>
{% endif %}
{% endfor %}
</ul>
{% endmacro %}
